<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Avoider — Simple 2D Game</title>
  <style>
    :root{--bg:#0b1020;--panel:#0f1724;--accent:#7dd3fc}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071026);font-family:Inter,system-ui,Segoe UI,Arial}
    #game-wrap{display:grid;place-items:center;height:100%;padding:24px}
    .panel{width:900px;max-width:100%;background:rgba(255,255,255,0.02);padding:18px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6);}
    header{display:flex;align-items:center;justify-content:space-between;color:#cfe8ff;margin-bottom:8px}
    header h1{font-size:20px;margin:0}
    #hud{display:flex;gap:12px;align-items:center}
    .ui-box{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;display:flex;align-items:center;gap:6px;}
    .slider-wrap{background:rgba(125,211,252,0.1);padding:6px 10px;border-radius:8px;}
    input[type=range]{width:140px;accent-color:var(--accent);background:rgba(255,255,255,0.08);height:6px;border-radius:4px;}
    button{background:transparent;border:1px solid rgba(125,211,252,0.18);color:var(--accent);padding:8px 12px;border-radius:8px;cursor:pointer}
    canvas{display:block;background:#071024;border-radius:8px;width:100%;height:520px}
    .muted{color:#9fb6cf;font-size:13px}
    footer{margin-top:8px;color:#9fb6cf;font-size:13px}
  </style>
</head>
<body>
  <div id="game-wrap">
    <div class="panel">
      <header>
        <h1>Avoider</h1>
        <div id="hud">
          <div class="ui-box"><span class="muted">Difficulty:</span><input id="diffSlider" type="range" min="0.5" max="3" step="0.1" value="1"></div>
          
          <button id="pauseBtn">Pause</button>
        </div>
          <button id="startBtn">Start / Restart</button>
        </div>
      </header>

      <div class="ui-box muted" style="margin-bottom:8px;">Move with ← → or A/D • Jump with ↑ or W</div>
      <div class="ui-box" style="justify-content:center;font-size:16px;color:#f8fafc;margin-bottom:8px;">
        <div style="margin-right:18px;">Score: <span id="score">0</span></div>
        <div>Dodges: <span id="dodges">0</span></div>
      </div>
      <canvas id="game" width="900" height="520"></canvas>
      <footer class="muted">Goal: survive as long as you can. Difficulty increases over time.</footer>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const scoreEl = document.getElementById('score');
    const dodgesEl = document.getElementById('dodges');
    const diffSlider = document.getElementById('diffSlider');

    const W = canvas.width, H = canvas.height;

    let running = false;
    let lastTime = 0;
    let delta = 0;
    let gravity = 1500;
    let player, obstacles, spawnTimer, score, speedMultiplier, difficulty = 1.0, dodges = 0;

    function reset() {
      player = { x: W/2 - 20, y: H - 64, w: 40, h: 48, vx: 0, vy: 0, speed: 420, onGround: true };
      obstacles = [];
      spawnTimer = 0;
      score = 0;
      dodges = 0;
      speedMultiplier = 1;
      scoreEl.textContent = 0;
      dodgesEl.textContent = 0;
      diffSlider.value = difficulty;
    }

    function start() {
      reset();
      running = true;
      lastTime = performance.now();
      requestAnimationFrame(loop);
    }

    function gameOver() {
      running = false;
      draw();
      ctx.fillStyle = 'rgba(2,8,20,0.6)';
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle = '#fff';
      ctx.font = '36px system-ui';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', W/2, H/2 - 10);
      ctx.font = '18px system-ui';
      ctx.fillText('Score: ' + Math.floor(score), W/2, H/2 + 20);
      ctx.fillText('Dodges: ' + dodges, W/2, H/2 + 48);
      ctx.fillText('Press Start / Restart to play again', W/2, H/2 + 80);
    }

    const keys = {};
    window.addEventListener('keydown', e => { keys[e.key.toLowerCase()] = true; });
    window.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false; });

    function spawnObstacle() {
      const t = Math.random();
      const shape = t < 0.33 ? 'rect' : t < 0.66 ? 'circle' : 'triangle';
      const w = 20 + Math.random() * (shape==='circle' ? 60 : 120);
      const h = (shape === 'triangle') ? (10 + Math.random() * 60) : (20 + Math.random() * 60);
      const x = Math.random() * (W - w);
      const baseSpeed = 120 + Math.random() * 220;
      const vy = baseSpeed * (0.8 + Math.random() * 0.8) * difficulty;
      obstacles.push({ x, y: -h - 20, w, h, vy, shape });
    }

    function update(dt) {
      difficulty = parseFloat(diffSlider.value);
      speedMultiplier += dt * 0.02 * difficulty;
      spawnTimer += dt;
      const spawnInterval = Math.max(0.18, 1.2 - speedMultiplier * 0.08);
      if (spawnTimer > spawnInterval) { spawnObstacle(); spawnTimer = 0; }

      let move = 0;
      if (keys['arrowleft'] || keys['a']) move -= 1;
      if (keys['arrowright'] || keys['d']) move += 1;
      player.vx = move * player.speed * (1 + (speedMultiplier - 1) * 0.55);

      if ((keys['arrowup'] || keys['w'] || keys[' ']) && player.onGround) { player.vy = -620; player.onGround = false; }

      player.vy += gravity * dt;
      player.x += player.vx * dt;
      player.y += player.vy * dt;

      if (player.x < 6) player.x = 6;
      if (player.x + player.w > W - 6) player.x = W - 6 - player.w;
      if (player.y + player.h >= H - 6) { player.y = H - 6 - player.h; player.vy = 0; player.onGround = true; }

      for (let i = obstacles.length - 1; i >= 0; --i) {
        const ob = obstacles[i];
        ob.y += ob.vy * dt * (1 + (speedMultiplier - 1) * 0.4);
        ob.vy += 12 * dt * speedMultiplier * difficulty;

        if (boundingOverlap(player, ob)) { gameOver(); return; }

        if (ob.y > H + 80) { obstacles.splice(i, 1); dodges += 1; score += 10; scoreEl.textContent = Math.floor(score); dodgesEl.textContent = dodges; }
      }

      score += dt * 10 * speedMultiplier * difficulty;
      scoreEl.textContent = Math.floor(score);
    }

    function boundingOverlap(a, b) {
      return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
    }

    function draw() {
      ctx.clearRect(0, 0, W, H);
      const g = ctx.createLinearGradient(0, 0, 0, H);
      g.addColorStop(0, '#061025'); g.addColorStop(1, '#051324');
      ctx.fillStyle = g; ctx.fillRect(0, 0, W, H);

      ctx.fillStyle = '#06162b';
      ctx.fillRect(0, H - 6, W, 6);

      roundRect(ctx, player.x, player.y, player.w, player.h, 8, true, '#ffd166');
      ctx.fillStyle = '#011627';
      ctx.fillRect(player.x + player.w - 12, player.y + 10, 6, 6);

      for (const ob of obstacles) {
        if (ob.shape === 'circle') {
          ctx.beginPath();
          ctx.arc(ob.x + ob.w / 2, ob.y + ob.h / 2, Math.max(ob.w, ob.h) / 2, 0, Math.PI * 2);
          ctx.fillStyle = '#ffd166'; ctx.fill();
        } else if (ob.shape === 'triangle') {
          ctx.fillStyle = '#ffd166'; ctx.beginPath(); ctx.moveTo(ob.x + ob.w / 2, ob.y); ctx.lineTo(ob.x + ob.w, ob.y + ob.h); ctx.lineTo(ob.x, ob.y + ob.h); ctx.closePath(); ctx.fill();
        } else {
          roundRect(ctx, ob.x, ob.y, ob.w, ob.h, 6, true, '#ffd166');
        }
      }

      ctx.fillStyle = 'rgba(255,255,255,0.03)';
      ctx.fillRect(8, 8, 240, 40);
    }

    function roundRect(ctx, x, y, w, h, r, fill, style) {
      ctx.beginPath(); ctx.moveTo(x + r, y); ctx.arcTo(x + w, y, x + w, y + h, r); ctx.arcTo(x + w, y + h, x, y + h, r); ctx.arcTo(x, y + h, x, y, r); ctx.arcTo(x, y, x + w, y, r); ctx.closePath(); if (fill) { ctx.fillStyle = style; ctx.fill(); } else { ctx.stroke(); }
    }

    function loop(now) {
      if (!running) return; delta = (now - lastTime) / 1000; lastTime = now; const dt = Math.min(0.05, delta);
      update(dt); draw(); requestAnimationFrame(loop);
    }

    canvas.addEventListener('touchstart', e => { e.preventDefault(); keys[' '] = true; setTimeout(() => keys[' '] = false, 120); });

    startBtn.addEventListener('click', () => { start(); canvas.focus(); });

    reset(); draw();

    window.addEventListener('keydown', e => { if (e.key.toLowerCase() === 'p') { running = !running; if (running) { lastTime = performance.now(); requestAnimationFrame(loop); } else draw(); } });

    pauseBtn.addEventListener('click',()=>{running=!running;if(running){lastTime=performance.now();requestAnimationFrame(loop);}else draw();});

    console.log('Controls: Left/Right arrows or A/D to move. Up or W to jump. Space also jumps. P to pause.');
  </script>
</body>
</html>
